<h1 id="upgrade-guide">Upgrade Guide</h1>
<ul>
<li><a href="#upgrade-9.0">Upgrading To 9.0 From 8.x</a></li>
</ul>
<p><a name="high-impact-changes"></a></p>
<h2 id="high-impact-changes">High Impact Changes</h2>
<div class="content-list" markdown="1">

<ul>
<li><a href="#updating-dependencies">Updating Dependencies</a></li>
<li><a href="#flysystem-3">Flysystem 3.x</a></li>
<li><a href="#symfony-mailer">Symfony Mailer</a></li>
</ul>
</div>

<p><a name="medium-impact-changes"></a></p>
<h2 id="medium-impact-changes">Medium Impact Changes</h2>
<div class="content-list" markdown="1">

<ul>
<li><a href="#belongs-to-many-first-or-new">Belongs To Many <code>firstOrNew</code>, <code>firstOrCreate</code>, and <code>updateOrCreate</code> methods</a></li>
<li><a href="#custom-casts-and-null">Custom Casts &amp; <code>null</code></a></li>
<li><a href="#http-client-default-timeout">Default HTTP Client Timeout</a></li>
<li><a href="#php-return-types">PHP Return Types</a></li>
<li><a href="#postgres-schema-configuration">Postgres &quot;Schema&quot; Configuration</a></li>
<li><a href="#the-assert-deleted-method">The <code>assertDeleted</code> Method</a></li>
<li><a href="#the-lang-directory">The <code>lang</code> Directory</a></li>
<li><a href="#the-password-rule">The <code>password</code> Rule</a></li>
<li><a href="#when-and-unless-methods">The <code>when</code> / <code>unless</code> Methods</a></li>
<li><a href="#unvalidated-array-keys">Unvalidated Array Keys</a></li>
</ul>
</div>

<p><a name="upgrade-9.0"></a></p>
<h2 id="upgrading-to-90-from-8x">Upgrading To 9.0 From 8.x</h2>
<p><a name="estimated-upgrade-time-10-minutes"></a></p>
<h4 id="estimated-upgrade-time-30-minutes">Estimated Upgrade Time: 30 Minutes</h4>
<blockquote>
<p><strong>Note</strong><br>We attempt to document every possible breaking change. Since some of these breaking changes are in obscure parts of the framework only a portion of these changes may actually affect your application. Want to save time? You can use <a href="https://laravelshift.com/">Laravel Shift</a> to help automate your application upgrades.</p>
</blockquote>
<p><a name="updating-dependencies"></a></p>
<h3 id="updating-dependencies">Updating Dependencies</h3>
<p><strong>Likelihood Of Impact: High</strong></p>
<h4 id="php-802-required">PHP 8.0.2 Required</h4>
<p>Laravel now requires PHP 8.0.2 or greater.</p>
<h4 id="composer-dependencies">Composer Dependencies</h4>
<p>You should update the following dependencies in your application&#39;s <code>composer.json</code> file:</p>
<div class="content-list" markdown="1">

<ul>
<li><code>laravel/framework</code> to <code>^9.0</code></li>
<li><code>nunomaduro/collision</code> to <code>^6.1</code></li>
</ul>
</div>

<p>In addition, please replace <code>facade/ignition</code> with <code>&quot;spatie/laravel-ignition&quot;: &quot;^1.0&quot;</code> and <code>pusher/pusher-php-server</code> (if applicable) with <code>&quot;pusher/pusher-php-server&quot;: &quot;^5.0&quot;</code> in your application&#39;s <code>composer.json</code> file.</p>
<p>Furthermore, the following first-party packages have received new major releases to support Laravel 9.x. If applicable, you should read their individual upgrade guides before upgrading:</p>
<div class="content-list" markdown="1">

<ul>
<li><a href="https://github.com/laravel/vonage-notification-channel/blob/3.x/UPGRADE.md">Vonage Notification Channel (v3.0)</a> (Replaces Nexmo)</li>
</ul>
</div>

<p>Finally, examine any other third-party packages consumed by your application and verify you are using the proper version for Laravel 9 support.</p>
<p><a name="php-return-types"></a></p>
<h4 id="php-return-types">PHP Return Types</h4>
<p>PHP is beginning to transition to requiring return type definitions on PHP methods such as <code>offsetGet</code>, <code>offsetSet</code>, etc. In light of this, Laravel 9 has implemented these return types in its code base. Typically, this should not affect user written code; however, if you are overriding one of these methods by extending Laravel&#39;s core classes, you will need to add these return types to your own application or package code:</p>
<div class="content-list" markdown="1">

<ul>
<li><code>count(): int</code></li>
<li><code>getIterator(): Traversable</code></li>
<li><code>getSize(): int</code></li>
<li><code>jsonSerialize(): array</code></li>
<li><code>offsetExists($key): bool</code></li>
<li><code>offsetGet($key): mixed</code></li>
<li><code>offsetSet($key, $value): void</code></li>
<li><code>offsetUnset($key): void</code></li>
</ul>
</div>

<p>In addition, return types were added to methods implementing PHP&#39;s <code>SessionHandlerInterface</code>. Again, it is unlikely that this change affects your own application or package code:</p>
<div class="content-list" markdown="1">

<ul>
<li><code>open($savePath, $sessionName): bool</code></li>
<li><code>close(): bool</code></li>
<li><code>read($sessionId): string|false</code></li>
<li><code>write($sessionId, $data): bool</code></li>
<li><code>destroy($sessionId): bool</code></li>
<li><code>gc($lifetime): int</code></li>
</ul>
</div>

<p><a name="application"></a></p>
<h3 id="application">Application</h3>
<p><a name="the-application-contract"></a></p>
<h4 id="the-application-contract">The <code>Application</code> Contract</h4>
<p><strong>Likelihood Of Impact: Low</strong></p>
<p>The <code>storagePath</code> method of the <code>Illuminate\Contracts\Foundation\Application</code> interface has been updated to accept a <code>$path</code> argument. If you are implementing this interface you should update your implementation accordingly:</p>
<pre><code><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">storagePath</span>(<span class="hljs-params"><span class="hljs-variable">$path</span> = <span class="hljs-string">&#x27;&#x27;</span></span>)</span>;
</code></pre>
<p>Similarly, the <code>langPath</code> method of the <code>Illuminate\Foundation\Application</code> class has been updated to accept a <code>$path</code> argument: </p>
<pre><code><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">langPath</span>(<span class="hljs-params"><span class="hljs-variable">$path</span> = <span class="hljs-string">&#x27;&#x27;</span></span>)</span>;
</code></pre>
<h4 id="exception-handler-ignore-method">Exception Handler <code>ignore</code> Method</h4>
<p><strong>Likelihood Of Impact: Low</strong></p>
<p>The exception handler&#39;s <code>ignore</code> method is now <code>public</code> instead of <code>protected</code>. This method is not included in the default application skeleton; however, if you have manually defined this method you should update its visibility to <code>public</code>:</p>
<pre><code class="language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ignore</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$class</span></span>)</span>;
</code></pre>
<h4 id="exception-handler-contract-binding">Exception Handler Contract Binding</h4>
<p><strong>Likelihood Of Impact: Very Low</strong></p>
<p>Previously, in order to override the default Laravel exception handler, custom implementations were bound into the service container using the <code>\App\Exceptions\Handler::class</code> type. However, you should now bind custom implementations using the <code>\Illuminate\Contracts\Debug\ExceptionHandler::class</code> type.</p>
<h3 id="blade">Blade</h3>
<h4 id="lazy-collections--the-loop-variable">Lazy Collections &amp; The <code>$loop</code> Variable</h4>
<p><strong>Likelihood Of Impact: Low</strong></p>
<p>When iterating over a <code>LazyCollection</code> instance within a Blade template, the <code>$loop</code> variable is no longer available, as accessing this variable causes the entire <code>LazyCollection</code> to be loaded into memory, thus rendering the usage of lazy collections pointless in this scenario.</p>
<h4 id="checked--disabled--selected-blade-directives">Checked / Disabled / Selected Blade Directives</h4>
<p><strong>Likelihood Of Impact: Low</strong></p>
<p>The new <code>@checked</code>, <code>@disabled</code>, and <code>@selected</code> Blade directives may conflict with Vue events of the same name. You may use <code>@@</code> to escape the directives and avoid this conflict: <code>@@selected</code>.</p>
<h3 id="collections">Collections</h3>
<h4 id="the-enumerable-contract">The <code>Enumerable</code> Contract</h4>
<p><strong>Likelihood Of Impact: Low</strong></p>
<p>The <code>Illuminate\Support\Enumerable</code> contract now defines a <code>sole</code> method. If you are manually implementing this interface, you should update your implementation to reflect this new method:</p>
<pre><code class="language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sole</span>(<span class="hljs-params"><span class="hljs-variable">$key</span> = <span class="hljs-literal">null</span>, <span class="hljs-variable">$operator</span> = <span class="hljs-literal">null</span>, <span class="hljs-variable">$value</span> = <span class="hljs-literal">null</span></span>)</span>;
</code></pre>
<h4 id="the-reducewithkeys-method">The <code>reduceWithKeys</code> Method</h4>
<p>The <code>reduceWithKeys</code> method has been removed as the <code>reduce</code> method provides the same functionality. You may simply update your code to call <code>reduce</code> instead of <code>reduceWithKeys</code>.</p>
<h4 id="the-reducemany-method">The <code>reduceMany</code> Method</h4>
<p>The <code>reduceMany</code> method has been renamed to <code>reduceSpread</code> for naming consistency with other similar methods.</p>
<h3 id="container">Container</h3>
<h4 id="the-container-contract">The <code>Container</code> Contract</h4>
<p><strong>Likelihood Of Impact: Very Low</strong></p>
<p>The <code>Illuminate\Contracts\Container\Container</code> contract has received two method definitions: <code>scoped</code> and <code>scopedIf</code>. If you are manually implementing this contract, you should update your implementation to reflect these new methods.</p>
<h4 id="the-contextualbindingbuilder-contract">The <code>ContextualBindingBuilder</code> Contract</h4>
<p><strong>Likelihood Of Impact: Very Low</strong></p>
<p>The <code>Illuminate\Contracts\Container\ContextualBindingBuilder</code> contract now defines a <code>giveConfig</code> method. If you are manually implementing this interface, you should update your implementation to reflect this new method:</p>
<pre><code class="language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">giveConfig</span>(<span class="hljs-params"><span class="hljs-variable">$key</span>, <span class="hljs-variable">$default</span> = <span class="hljs-literal">null</span></span>)</span>;
</code></pre>
<h3 id="database">Database</h3>
<p><a name="postgres-schema-configuration"></a></p>
<h4 id="postgres-schema-configuration">Postgres &quot;Schema&quot; Configuration</h4>
<p><strong>Likelihood Of Impact: Medium</strong></p>
<p>The <code>schema</code> configuration option used to configure Postgres connection search paths in your application&#39;s <code>config/database.php</code> configuration file should be renamed to <code>search_path</code>.</p>
<p><a name="schema-builder-doctrine-method"></a></p>
<h4 id="schema-builder-registercustomdoctrinetype-method">Schema Builder <code>registerCustomDoctrineType</code> Method</h4>
<p><strong>Likelihood Of Impact: Low</strong></p>
<p>The <code>registerCustomDoctrineType</code> method has been removed from the <code>Illuminate\Database\Schema\Builder</code> class. You may use the <code>registerDoctrineType</code> method on the <code>DB</code> facade instead, or register custom Doctrine types in the <code>config/database.php</code> configuration file.</p>
<h3 id="eloquent">Eloquent</h3>
<p><a name="custom-casts-and-null"></a></p>
<h4 id="custom-casts--null">Custom Casts &amp; <code>null</code></h4>
<p><strong>Likelihood Of Impact: Medium</strong></p>
<p>In previous releases of Laravel, the <code>set</code> method of custom cast classes was not invoked if the cast attribute was being set to <code>null</code>. However, this behavior was inconsistent with the Laravel documentation. In Laravel 9.x, the <code>set</code> method of the cast class will be invoked with <code>null</code> as the provided <code>$value</code> argument. Therefore, you should ensure your custom casts are able to sufficiently handle this scenario:</p>
<pre><code class="language-php"><span class="hljs-comment">/**
 * Prepare the given value for storage.
 *
 * <span class="hljs-doctag">@param</span>  \Illuminate\Database\Eloquent\Model  $model
 * <span class="hljs-doctag">@param</span>  string  $key
 * <span class="hljs-doctag">@param</span>  AddressModel  $value
 * <span class="hljs-doctag">@param</span>  array  $attributes
 * <span class="hljs-doctag">@return</span> array
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set</span>(<span class="hljs-params"><span class="hljs-variable">$model</span>, <span class="hljs-variable">$key</span>, <span class="hljs-variable">$value</span>, <span class="hljs-variable">$attributes</span></span>)
</span>{
    <span class="hljs-keyword">if</span> (! <span class="hljs-variable">$value</span> <span class="hljs-keyword">instanceof</span> AddressModel) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">&#x27;The given value is not an Address instance.&#x27;</span>);
    }

    <span class="hljs-keyword">return</span> [
        <span class="hljs-string">&#x27;address_line_one&#x27;</span> =&gt; <span class="hljs-variable">$value</span>-&gt;lineOne,
        <span class="hljs-string">&#x27;address_line_two&#x27;</span> =&gt; <span class="hljs-variable">$value</span>-&gt;lineTwo,
    ];
}
</code></pre>
<p><a name="belongs-to-many-first-or-new"></a></p>
<h4 id="belongs-to-many-firstornew-firstorcreate-and-updateorcreate-methods">Belongs To Many <code>firstOrNew</code>, <code>firstOrCreate</code>, and <code>updateOrCreate</code> Methods</h4>
<p><strong>Likelihood Of Impact: Medium</strong></p>
<p>The <code>belongsToMany</code> relationship&#39;s <code>firstOrNew</code>, <code>firstOrCreate</code>, and <code>updateOrCreate</code> methods all accept an array of attributes as their first argument. In previous releases of Laravel, this array of attributes was compared against the &quot;pivot&quot; / intermediate table for existing records.</p>
<p>However, this behavior was unexpected and typically unwanted. Instead, these methods now compare the array of attributes against the table of the related model:</p>
<pre><code class="language-php"><span class="hljs-variable">$user</span>-&gt;<span class="hljs-title function_ invoke__">roles</span>()-&gt;<span class="hljs-title function_ invoke__">updateOrCreate</span>([
    <span class="hljs-string">&#x27;name&#x27;</span> =&gt; <span class="hljs-string">&#x27;Administrator&#x27;</span>,
]);
</code></pre>
<p>In addition, the <code>firstOrCreate</code> method now accepts a <code>$values</code> array as its second argument. This array will be merged with the first argument to the method (<code>$attributes</code>) when creating the related model if one does not already exist. This change makes this method consistent with the <code>firstOrCreate</code> methods offered by other relationship types:</p>
<pre><code class="language-php"><span class="hljs-variable">$user</span>-&gt;<span class="hljs-title function_ invoke__">roles</span>()-&gt;<span class="hljs-title function_ invoke__">firstOrCreate</span>([
    <span class="hljs-string">&#x27;name&#x27;</span> =&gt; <span class="hljs-string">&#x27;Administrator&#x27;</span>,
], [
    <span class="hljs-string">&#x27;created_by&#x27;</span> =&gt; <span class="hljs-variable">$user</span>-&gt;id,
]);
</code></pre>
<h4 id="the-touch-method">The <code>touch</code> Method</h4>
<p><strong>Likelihood Of Impact: Low</strong></p>
<p>The <code>touch</code> method now accepts an attribute to touch. If you were previously overwriting this method, you should update your method signature to reflect this new argument:</p>
<pre><code class="language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">touch</span>(<span class="hljs-params"><span class="hljs-variable">$attribute</span> = <span class="hljs-literal">null</span></span>)</span>;
</code></pre>
<h3 id="encryption">Encryption</h3>
<h4 id="the-encrypter-contract">The Encrypter Contract</h4>
<p><strong>Likelihood Of Impact: Low</strong></p>
<p>The <code>Illuminate\Contracts\Encryption\Encrypter</code> contract now defines a <code>getKey</code> method. If you are manually implementing this interface, you should update your implementation accordingly:</p>
<pre><code class="language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getKey</span>(<span class="hljs-params"></span>)</span>;
</code></pre>
<h3 id="facades">Facades</h3>
<h4 id="the-getfacadeaccessor-method">The <code>getFacadeAccessor</code> Method</h4>
<p><strong>Likelihood Of Impact: Low</strong></p>
<p>The <code>getFacadeAccessor</code> method must always return a container binding key. In previous releases of Laravel, this method could return an object instance; however, this behavior is no longer supported. If you have written your own facades, you should ensure that this method returns a container binding string:</p>
<pre><code class="language-php"><span class="hljs-comment">/**
 * Get the registered name of the component.
 *
 * <span class="hljs-doctag">@return</span> string
 */</span>
<span class="hljs-keyword">protected</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFacadeAccessor</span>(<span class="hljs-params"></span>)
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Example</span>::<span class="hljs-variable language_">class</span>;
}
</code></pre>
<h3 id="filesystem">Filesystem</h3>
<h4 id="the-filesystem_driver-environment-variable">The <code>FILESYSTEM_DRIVER</code> Environment Variable</h4>
<p><strong>Likelihood Of Impact: Low</strong></p>
<p>The <code>FILESYSTEM_DRIVER</code> environment variable has been renamed to <code>FILESYSTEM_DISK</code> to more accurately reflect its usage. This change only affects the application skeleton; however, you are welcome to update your own application&#39;s environment variables to reflect this change if you wish.</p>
<h4 id="the-cloud-disk">The &quot;Cloud&quot; Disk</h4>
<p><strong>Likelihood Of Impact: Low</strong></p>
<p>The <code>cloud</code> disk configuration option was removed from the default application skeleton in November of 2020. This change only affects the application skeleton. If you are using the <code>cloud</code> disk within your application, you should leave this configuration value in your own application&#39;s skeleton.</p>
<p><a name="flysystem-3"></a></p>
<h3 id="flysystem-3x">Flysystem 3.x</h3>
<p><strong>Likelihood Of Impact: High</strong></p>
<p>Laravel 9.x has migrated from <a href="https://flysystem.thephpleague.com/v2/docs/">Flysystem</a> 1.x to 3.x. Under the hood, Flysystem powers all of the file manipulation methods provided by the <code>Storage</code> facade. In light of this, some changes may be required within your application; however, we have tried to make this transition as seamless as possible.</p>
<h4 id="driver-prerequisites">Driver Prerequisites</h4>
<p>Before using the S3, FTP, or SFTP drivers, you will need to install the appropriate package via the Composer package manager:</p>
<ul>
<li>Amazon S3: <code>composer require -W league/flysystem-aws-s3-v3 &quot;^3.0&quot;</code></li>
<li>FTP: <code>composer require league/flysystem-ftp &quot;^3.0&quot;</code></li>
<li>SFTP: <code>composer require league/flysystem-sftp-v3 &quot;^3.0&quot;</code></li>
</ul>
<h4 id="overwriting-existing-files">Overwriting Existing Files</h4>
<p>Write operations such as <code>put</code>, <code>write</code>, and <code>writeStream</code> now overwrite existing files by default. If you do not want to overwrite existing files, you should manually check for the file&#39;s existence before performing the write operation.</p>
<h4 id="write-exceptions">Write Exceptions</h4>
<p>Write operations such as <code>put</code>, <code>write</code>, and <code>writeStream</code> no longer throw an exception when a write operation fails. Instead, <code>false</code> is returned. If you would like to preserve the previous behavior which threw exceptions, you may define the <code>throw</code> option within a filesystem disk&#39;s configuration array:</p>
<pre><code class="language-php"><span class="hljs-string">&#x27;public&#x27;</span> =&gt; [
    <span class="hljs-string">&#x27;driver&#x27;</span> =&gt; <span class="hljs-string">&#x27;local&#x27;</span>,
    <span class="hljs-comment">// ...</span>
    <span class="hljs-string">&#x27;throw&#x27;</span> =&gt; <span class="hljs-literal">true</span>,
],
</code></pre>
<h4 id="reading-missing-files">Reading Missing Files</h4>
<p>Attempting to read from a file that does not exist now returns <code>null</code>. In previous releases of Laravel, an <code>Illuminate\Contracts\Filesystem\FileNotFoundException</code> would have been thrown.</p>
<h4 id="deleting-missing-files">Deleting Missing Files</h4>
<p>Attempting to <code>delete</code> a file that does not exist now returns <code>true</code>.</p>
<h4 id="cached-adapters">Cached Adapters</h4>
<p>Flysystem no longer supports &quot;cached adapters&quot;. Thus, they have been removed from Laravel and any relevant configuration (such as the <code>cache</code> key within disk configurations) can be removed.</p>
<h4 id="custom-filesystems">Custom Filesystems</h4>
<p>Slight changes have been made to the steps required to register custom filesystem drivers. Therefore, if you were defining your own custom filesystem drivers, or using packages that define custom drivers, you should update your code and dependencies.</p>
<p>For example, in Laravel 8.x, a custom filesystem driver might be registered like so:</p>
<pre><code class="language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">Storage</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">League</span>\<span class="hljs-title">Flysystem</span>\<span class="hljs-title">Filesystem</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Spatie</span>\<span class="hljs-title">Dropbox</span>\<span class="hljs-title">Client</span> <span class="hljs-keyword">as</span> <span class="hljs-title">DropboxClient</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Spatie</span>\<span class="hljs-title">FlysystemDropbox</span>\<span class="hljs-title">DropboxAdapter</span>;

<span class="hljs-title class_">Storage</span>::<span class="hljs-title function_ invoke__">extend</span>(<span class="hljs-string">&#x27;dropbox&#x27;</span>, function (<span class="hljs-variable">$app</span>, <span class="hljs-variable">$config</span>) {
    <span class="hljs-variable">$client</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DropboxClient</span>(
        <span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;authorization_token&#x27;</span>]
    );

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Filesystem</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DropboxAdapter</span>(<span class="hljs-variable">$client</span>));
});
</code></pre>
<p>However, in Laravel 9.x, the callback given to the <code>Storage::extend</code> method should return an instance of <code>Illuminate\Filesystem\FilesystemAdapter</code> directly:</p>
<pre><code class="language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Filesystem</span>\<span class="hljs-title">FilesystemAdapter</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">Storage</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">League</span>\<span class="hljs-title">Flysystem</span>\<span class="hljs-title">Filesystem</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Spatie</span>\<span class="hljs-title">Dropbox</span>\<span class="hljs-title">Client</span> <span class="hljs-keyword">as</span> <span class="hljs-title">DropboxClient</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">Spatie</span>\<span class="hljs-title">FlysystemDropbox</span>\<span class="hljs-title">DropboxAdapter</span>;

<span class="hljs-title class_">Storage</span>::<span class="hljs-title function_ invoke__">extend</span>(<span class="hljs-string">&#x27;dropbox&#x27;</span>, function (<span class="hljs-variable">$app</span>, <span class="hljs-variable">$config</span>) {
    <span class="hljs-variable">$adapter</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DropboxAdapter</span>(
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">DropboxClient</span>(<span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;authorization_token&#x27;</span>])
    );

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FilesystemAdapter</span>(
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Filesystem</span>(<span class="hljs-variable">$adapter</span>, <span class="hljs-variable">$config</span>),
        <span class="hljs-variable">$adapter</span>,
        <span class="hljs-variable">$config</span>
    );
});
</code></pre>
<h3 id="helpers">Helpers</h3>
<p><a name="data-get-function"></a></p>
<h4 id="the-data_get-helper--iterable-objects">The <code>data_get</code> Helper &amp; Iterable Objects</h4>
<p><strong>Likelihood Of Impact: Very Low</strong></p>
<p>Previously, the <code>data_get</code> helper could be used to retrieve nested data on arrays and <code>Collection</code> instances; however, this helper can now retrieve nested data on all iterable objects.</p>
<p><a name="str-function"></a></p>
<h4 id="the-str-helper">The <code>str</code> Helper</h4>
<p><strong>Likelihood Of Impact: Very Low</strong></p>
<p>Laravel 9.x now includes a global <code>str</code> <a href="/docs/%7B%7Bversion%7D%7D/helpers#method-str">helper function</a>. If you are defining a global <code>str</code> helper in your application, you should rename or remove it so that it does not conflict with Laravel&#39;s own <code>str</code> helper.</p>
<p><a name="when-and-unless-methods"></a></p>
<h4 id="the-when--unless-methods">The <code>when</code> / <code>unless</code> Methods</h4>
<p><strong>Likelihood Of Impact: Medium</strong></p>
<p>As you may know, <code>when</code> and <code>unless</code> methods are offered by various classes throughout the framework. These methods can be used to conditionally perform an action if the boolean value of the first argument to the method evaluates to <code>true</code> or <code>false</code>:</p>
<pre><code class="language-php"><span class="hljs-variable">$collection</span>-&gt;<span class="hljs-title function_ invoke__">when</span>(<span class="hljs-literal">true</span>, function (<span class="hljs-variable">$collection</span>) {
    <span class="hljs-variable">$collection</span>-&gt;<span class="hljs-title function_ invoke__">merge</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);
});
</code></pre>
<p>Therefore, in previous releases of Laravel, passing a closure to the <code>when</code> or <code>unless</code> methods meant that the conditional operation would always execute, since a loose comparison against a closure object (or any other object) always evaluates to <code>true</code>. This often led to unexpected outcomes because developers expect the <strong>result</strong> of the closure to be used as the boolean value that determines if the conditional action executes.</p>
<p>So, in Laravel 9.x, any closures passed to the <code>when</code> or <code>unless</code> methods will be executed and the value returned by the closure will be considered the boolean value used by the <code>when</code> and <code>unless</code> methods:</p>
<pre><code class="language-php"><span class="hljs-variable">$collection</span>-&gt;<span class="hljs-title function_ invoke__">when</span>(function (<span class="hljs-variable">$collection</span>) {
    <span class="hljs-comment">// This closure is executed...</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-variable">$collection</span></span>) </span>{
    <span class="hljs-comment">// Not executed since first closure returned &quot;false&quot;...</span>
    <span class="hljs-variable">$collection</span>-&gt;<span class="hljs-title function_ invoke__">merge</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);
});
</code></pre>
<h3 id="http-client">HTTP Client</h3>
<p><a name="http-client-default-timeout"></a></p>
<h4 id="default-timeout">Default Timeout</h4>
<p><strong>Likelihood Of Impact: Medium</strong></p>
<p>The <a href="/docs/%7B%7Bversion%7D%7D/http-client">HTTP client</a> now has a default timeout of 30 seconds. In other words, if the server does not respond within 30 seconds, an exception will be thrown. Previously, no default timeout length was configured on the HTTP client, causing requests to sometimes &quot;hang&quot; indefinitely.</p>
<p>If you wish to specify a longer timeout for a given request, you may do so using the <code>timeout</code> method:</p>
<pre><code><span class="hljs-variable">$response</span> = <span class="hljs-title class_">Http</span>::<span class="hljs-title function_ invoke__">timeout</span>(<span class="hljs-number">120</span>)-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-comment">/* ... */</span>);
</code></pre>
<h4 id="http-fake--middleware">HTTP Fake &amp; Middleware</h4>
<p><strong>Likelihood Of Impact: Low</strong></p>
<p>Previously, Laravel would not execute any provided Guzzle HTTP middleware when the <a href="/docs/%7B%7Bversion%7D%7D/http-client">HTTP client</a> was &quot;faked&quot;. However, in Laravel 9.x, Guzzle HTTP middleware will be executed even when the HTTP client is faked.</p>
<h4 id="http-fake--dependency-injection">HTTP Fake &amp; Dependency Injection</h4>
<p><strong>Likelihood Of Impact: Low</strong></p>
<p>In previous releases of Laravel, invoking the <code>Http::fake()</code> method would not affect instances of the <code>Illuminate\Http\Client\Factory</code> that were injected into class constructors. However, in Laravel 9.x, <code>Http::fake()</code> will ensure fake responses are returned by HTTP clients injected into other services via dependency injection. This behavior is more consistent with the behavior of other facades and fakes.</p>
<p><a name="symfony-mailer"></a></p>
<h3 id="symfony-mailer">Symfony Mailer</h3>
<p><strong>Likelihood Of Impact: High</strong></p>
<p>One of the largest changes in Laravel 9.x is the transition from SwiftMailer, which is no longer maintained as of December 2021, to Symfony Mailer. However, we have tried to make this transition as seamless as possible for your applications. That being said, please thoroughly review the list of changes below to ensure your application is fully compatible.</p>
<h4 id="driver-prerequisites-1">Driver Prerequisites</h4>
<p>To continue using the Mailgun transport, your application should require the <code>symfony/mailgun-mailer</code> and <code>symfony/http-client</code> Composer packages:</p>
<pre><code class="language-shell">composer require symfony/mailgun-mailer symfony/http-client
</code></pre>
<p>The <code>wildbit/swiftmailer-postmark</code> Composer package should be removed from your application. Instead, your application should require the <code>symfony/postmark-mailer</code> and <code>symfony/http-client</code> Composer packages:</p>
<pre><code class="language-shell">composer require symfony/postmark-mailer symfony/http-client
</code></pre>
<h4 id="updated-return-types">Updated Return Types</h4>
<p>The <code>send</code>, <code>html</code>, <code>raw</code>, and <code>plain</code> methods on <code>Illuminate\Mail\Mailer</code> no longer return <code>void</code>. Instead, an instance of <code>Illuminate\Mail\SentMessage</code> is returned. This object contains an instance of <code>Symfony\Component\Mailer\SentMessage</code> that is accessible via the <code>getSymfonySentMessage</code> method or by dynamically invoking methods on the object.</p>
<h4 id="renamed-swift-methods">Renamed &quot;Swift&quot; Methods</h4>
<p>Various SwiftMailer related methods, some of which were undocumented, have been renamed to their Symfony Mailer counterparts. For example, the <code>withSwiftMessage</code> method has been renamed to <code>withSymfonyMessage</code>:</p>
<pre><code><span class="hljs-comment">// Laravel 8.x...</span>
<span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">withSwiftMessage</span>(function (<span class="hljs-variable">$message</span>) {
    <span class="hljs-variable">$message</span>-&gt;<span class="hljs-title function_ invoke__">getHeaders</span>()-&gt;<span class="hljs-title function_ invoke__">addTextHeader</span>(
        <span class="hljs-string">&#x27;Custom-Header&#x27;</span>, <span class="hljs-string">&#x27;Header Value&#x27;</span>
    );
});

<span class="hljs-comment">// Laravel 9.x...</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Mime</span>\<span class="hljs-title">Email</span>;

<span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">withSymfonyMessage</span>(function (Email <span class="hljs-variable">$message</span>) {
    <span class="hljs-variable">$message</span>-&gt;<span class="hljs-title function_ invoke__">getHeaders</span>()-&gt;<span class="hljs-title function_ invoke__">addTextHeader</span>(
        <span class="hljs-string">&#x27;Custom-Header&#x27;</span>, <span class="hljs-string">&#x27;Header Value&#x27;</span>
    );
});
</code></pre>
<blockquote>
<p><strong>Warning</strong><br>Please thoroughly review the <a href="https://symfony.com/doc/6.0/mailer.html#creating-sending-messages">Symfony Mailer documentation</a> for all possible interactions with the <code>Symfony\Component\Mime\Email</code> object.</p>
</blockquote>
<p>The list below contains a more thorough overview of renamed methods. Many of these methods are low-level methods used to interact with SwiftMailer / Symfony Mailer directly, so may not be commonly used within most Laravel applications:</p>
<pre><code><span class="hljs-title class_">Message</span>::<span class="hljs-title function_ invoke__">getSwiftMessage</span>();
<span class="hljs-title class_">Message</span>::<span class="hljs-title function_ invoke__">getSymfonyMessage</span>();

<span class="hljs-title class_">Mailable</span>::<span class="hljs-title function_ invoke__">withSwiftMessage</span>(<span class="hljs-variable">$callback</span>);
<span class="hljs-title class_">Mailable</span>::<span class="hljs-title function_ invoke__">withSymfonyMessage</span>(<span class="hljs-variable">$callback</span>);

<span class="hljs-title class_">MailMessage</span>::<span class="hljs-title function_ invoke__">withSwiftMessage</span>(<span class="hljs-variable">$callback</span>);
<span class="hljs-title class_">MailMessage</span>::<span class="hljs-title function_ invoke__">withSymfonyMessage</span>(<span class="hljs-variable">$callback</span>);

<span class="hljs-title class_">Mailer</span>::<span class="hljs-title function_ invoke__">getSwiftMailer</span>();
<span class="hljs-title class_">Mailer</span>::<span class="hljs-title function_ invoke__">getSymfonyTransport</span>();

<span class="hljs-title class_">Mailer</span>::<span class="hljs-title function_ invoke__">setSwiftMailer</span>(<span class="hljs-variable">$swift</span>);
<span class="hljs-title class_">Mailer</span>::<span class="hljs-title function_ invoke__">setSymfonyTransport</span>(TransportInterface <span class="hljs-variable">$transport</span>);

<span class="hljs-title class_">MailManager</span>::<span class="hljs-title function_ invoke__">createTransport</span>(<span class="hljs-variable">$config</span>);
<span class="hljs-title class_">MailManager</span>::<span class="hljs-title function_ invoke__">createSymfonyTransport</span>(<span class="hljs-variable">$config</span>);
</code></pre>
<h4 id="proxied-illuminatemailmessage-methods">Proxied <code>Illuminate\Mail\Message</code> Methods</h4>
<p>The <code>Illuminate\Mail\Message</code> typically proxied missing methods to the underlying <code>Swift_Message</code> instance. However, missing methods are now proxied to an instance of <code>Symfony\Component\Mime\Email</code> instead. So, any code that was previously relying on missing methods to be proxied to SwiftMailer should be updated to their corresponding Symfony Mailer counterparts.</p>
<p>Again, many applications may not be interacting with these methods, as they are not documented within the Laravel documentation:</p>
<pre><code><span class="hljs-comment">// Laravel 8.x...</span>
<span class="hljs-variable">$message</span>
    -&gt;<span class="hljs-title function_ invoke__">setFrom</span>(<span class="hljs-string">&#x27;taylor@laravel.com&#x27;</span>)
    -&gt;<span class="hljs-title function_ invoke__">setTo</span>(<span class="hljs-string">&#x27;example@example.org&#x27;</span>)
    -&gt;<span class="hljs-title function_ invoke__">setSubject</span>(<span class="hljs-string">&#x27;Order Shipped&#x27;</span>)
    -&gt;<span class="hljs-title function_ invoke__">setBody</span>(<span class="hljs-string">&#x27;&lt;h1&gt;HTML&lt;/h1&gt;&#x27;</span>, <span class="hljs-string">&#x27;text/html&#x27;</span>)
    -&gt;<span class="hljs-title function_ invoke__">addPart</span>(<span class="hljs-string">&#x27;Plain Text&#x27;</span>, <span class="hljs-string">&#x27;text/plain&#x27;</span>);

<span class="hljs-comment">// Laravel 9.x...</span>
<span class="hljs-variable">$message</span>
    -&gt;<span class="hljs-keyword">from</span>(<span class="hljs-string">&#x27;taylor@laravel.com&#x27;</span>)
    -&gt;<span class="hljs-title function_ invoke__">to</span>(<span class="hljs-string">&#x27;example@example.org&#x27;</span>)
    -&gt;<span class="hljs-title function_ invoke__">subject</span>(<span class="hljs-string">&#x27;Order Shipped&#x27;</span>)
    -&gt;<span class="hljs-title function_ invoke__">html</span>(<span class="hljs-string">&#x27;&lt;h1&gt;HTML&lt;/h1&gt;&#x27;</span>)
    -&gt;<span class="hljs-title function_ invoke__">text</span>(<span class="hljs-string">&#x27;Plain Text&#x27;</span>);
</code></pre>
<h4 id="generated-messages-ids">Generated Messages IDs</h4>
<p>SwiftMailer offered the ability to define a custom domain to include in generated Message IDs via the <code>mime.idgenerator.idright</code> configuration option. This is not supported by Symfony Mailer. Instead, Symfony Mailer will automatically generate a Message ID based on the sender.</p>
<h4 id="messagesent-event-changes"><code>MessageSent</code> Event Changes</h4>
<p>The <code>message</code> property of the <code>Illuminate\Mail\Events\MessageSent</code> event now contains an instance of <code>Symfony\Component\Mime\Email</code> instead of an instance of <code>Swift_Message</code>. This message represents the email <strong>before</strong> it is sent.</p>
<p>Additionally, a new <code>sent</code> property has been added to the <code>MessageSent</code> event. This property contains an instance of <code>Illuminate\Mail\SentMessage</code> and contains information about the sent email, such as the message ID.</p>
<h4 id="forced-reconnections">Forced Reconnections</h4>
<p>It is no longer possible to force a transport reconnection (for example when the mailer is running via a daemon process). Instead, Symfony Mailer will attempt to reconnect to the transport automatically and throw an exception if the reconnection fails.</p>
<h4 id="smtp-stream-options">SMTP Stream Options</h4>
<p>Defining stream options for the SMTP transport is no longer supported. Instead, you must define the relevant options directly within the configuration if they are supported. For example, to disable TLS peer verification:</p>
<pre><code><span class="hljs-string">&#x27;smtp&#x27;</span> =&gt; [
    <span class="hljs-comment">// Laravel 8.x...</span>
    <span class="hljs-string">&#x27;stream&#x27;</span> =&gt; [
        <span class="hljs-string">&#x27;ssl&#x27;</span> =&gt; [
            <span class="hljs-string">&#x27;verify_peer&#x27;</span> =&gt; <span class="hljs-literal">false</span>,
        ],
    ],

    <span class="hljs-comment">// Laravel 9.x...</span>
    <span class="hljs-string">&#x27;verify_peer&#x27;</span> =&gt; <span class="hljs-literal">false</span>,
],
</code></pre>
<p>To learn more about the available configuration options, please review the <a href="https://symfony.com/doc/6.0/mailer.html#transport-setup">Symfony Mailer documentation</a>.</p>
<blockquote>
<p><strong>Warning</strong><br>In spite of the example above, you are not generally advised to disable SSL verification since it introduces the possibility of &quot;man-in-the-middle&quot; attacks.</p>
</blockquote>
<h4 id="smtp-auth_mode">SMTP <code>auth_mode</code></h4>
<p>Defining the SMTP <code>auth_mode</code> in the <code>mail</code> configuration file is no longer required. The authentication mode will be automatically negotiated between Symfony Mailer and the SMTP server.</p>
<h4 id="failed-recipients">Failed Recipients</h4>
<p>It is no longer possible to retrieve a list of failed recipients after sending a message. Instead, a <code>Symfony\Component\Mailer\Exception\TransportExceptionInterface</code> exception will be thrown if a message fails to send. Instead of relying on retrieving invalid email addresses after sending a message, we recommend that you validate email addresses before sending the message instead.</p>
<h3 id="packages">Packages</h3>
<p><a name="the-lang-directory"></a></p>
<h4 id="the-lang-directory">The <code>lang</code> Directory</h4>
<p><strong>Likelihood Of Impact: Medium</strong></p>
<p>In new Laravel applications, the <code>resources/lang</code> directory is now located in the root project directory (<code>lang</code>). If your package is publishing language files to this directory, you should ensure that your package is publishing to <code>app()-&gt;langPath()</code> instead of a hard-coded path.</p>
<p><a name="queue"></a></p>
<h3 id="queue">Queue</h3>
<p><a name="the-opis-closure-library"></a></p>
<h4 id="the-opisclosure-library">The <code>opis/closure</code> Library</h4>
<p><strong>Likelihood Of Impact: Low</strong></p>
<p>Laravel&#39;s dependency on <code>opis/closure</code> has been replaced by <code>laravel/serializable-closure</code>. This should not cause any breaking change in your application unless you are interacting with the <code>opis/closure</code> library directly. In addition, the previously deprecated <code>Illuminate\Queue\SerializableClosureFactory</code> and <code>Illuminate\Queue\SerializableClosure</code> classes have been removed. If you are interacting with <code>opis/closure</code> library directly or using any of the removed classes, you may use <a href="https://github.com/laravel/serializable-closure">Laravel Serializable Closure</a> instead.</p>
<h4 id="the-failed-job-provider-flush-method">The Failed Job Provider <code>flush</code> Method</h4>
<p><strong>Likelihood Of Impact: Low</strong></p>
<p>The <code>flush</code> method defined by the <code>Illuminate\Queue\Failed\FailedJobProviderInterface</code> interface now accepts an <code>$hours</code> argument which determines how old a failed job must be (in hours) before it is flushed by the <code>queue:flush</code> command. If you are manually implementing the <code>FailedJobProviderInterface</code> you should ensure that your implementation is updated to reflect this new argument:</p>
<pre><code class="language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">flush</span>(<span class="hljs-params"><span class="hljs-variable">$hours</span> = <span class="hljs-literal">null</span></span>)</span>;
</code></pre>
<h3 id="session">Session</h3>
<h4 id="the-getsession-method">The <code>getSession</code> Method</h4>
<p><strong>Likelihood Of Impact: Low</strong></p>
<p>The <code>Symfony\Component\HttpFoundaton\Request</code> class that is extended by Laravel&#39;s own <code>Illuminate\Http\Request</code> class offers a <code>getSession</code> method to get the current session storage handler. This method is not documented by Laravel as most Laravel applications interact with the session through Laravel&#39;s own <code>session</code> method.</p>
<p>The <code>getSession</code> method previously returned an instance of <code>Illuminate\Session\Store</code> or <code>null</code>; however, due to the Symfony 6.x release enforcing a return type of <code>Symfony\Component\HttpFoundation\Session\SessionInterface</code>, the <code>getSession</code> now correctly returns a <code>SessionInterface</code> implementation or throws an <code>\Symfony\Component\HttpFoundation\Exception\SessionNotFoundException</code> exception when no session is available.</p>
<h3 id="testing">Testing</h3>
<p><a name="the-assert-deleted-method"></a></p>
<h4 id="the-assertdeleted-method">The <code>assertDeleted</code> Method</h4>
<p><strong>Likelihood Of Impact: Medium</strong></p>
<p>All calls to the <code>assertDeleted</code> method should be updated to <code>assertModelMissing</code>.</p>
<h3 id="trusted-proxies">Trusted Proxies</h3>
<p><strong>Likelihood Of Impact: Low</strong></p>
<p>If you are upgrading your Laravel 8 project to Laravel 9 by importing your existing application code into a totally new Laravel 9 application skeleton, you may need to update your application&#39;s &quot;trusted proxy&quot; middleware.</p>
<p>Within your <code>app/Http/Middleware/TrustProxies.php</code> file, update <code>use Fideloper\Proxy\TrustProxies as Middleware</code> to <code>use Illuminate\Http\Middleware\TrustProxies as Middleware</code>.</p>
<p>Next, within <code>app/Http/Middleware/TrustProxies.php</code>, you should update the <code>$headers</code> property definition:</p>
<pre><code class="language-php"><span class="hljs-comment">// Before...</span>
<span class="hljs-keyword">protected</span> <span class="hljs-variable">$headers</span> = <span class="hljs-title class_">Request</span>::<span class="hljs-variable constant_">HEADER_X_FORWARDED_ALL</span>;

<span class="hljs-comment">// After...</span>
<span class="hljs-keyword">protected</span> <span class="hljs-variable">$headers</span> =
    <span class="hljs-title class_">Request</span>::<span class="hljs-variable constant_">HEADER_X_FORWARDED_FOR</span> |
    <span class="hljs-title class_">Request</span>::<span class="hljs-variable constant_">HEADER_X_FORWARDED_HOST</span> |
    <span class="hljs-title class_">Request</span>::<span class="hljs-variable constant_">HEADER_X_FORWARDED_PORT</span> |
    <span class="hljs-title class_">Request</span>::<span class="hljs-variable constant_">HEADER_X_FORWARDED_PROTO</span> |
    <span class="hljs-title class_">Request</span>::<span class="hljs-variable constant_">HEADER_X_FORWARDED_AWS_ELB</span>;
</code></pre>
<p>Finally, you can remove the <code>fideloper/proxy</code> Composer dependency from your application:</p>
<pre><code class="language-shell">composer remove fideloper/proxy
</code></pre>
<h3 id="validation">Validation</h3>
<h4 id="form-request-validated-method">Form Request <code>validated</code> Method</h4>
<p><strong>Likelihood Of Impact: Low</strong></p>
<p>The <code>validated</code> method offered by form requests now accepts <code>$key</code> and <code>$default</code> arguments. If you are manually overwriting the definition of this method, you should update your method&#39;s signature to reflect these new arguments:</p>
<pre><code class="language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validated</span>(<span class="hljs-params"><span class="hljs-variable">$key</span> = <span class="hljs-literal">null</span>, <span class="hljs-variable">$default</span> = <span class="hljs-literal">null</span></span>)</span>
</code></pre>
<p><a name="the-password-rule"></a></p>
<h4 id="the-password-rule">The <code>password</code> Rule</h4>
<p><strong>Likelihood Of Impact: Medium</strong></p>
<p>The <code>password</code> rule, which validates that the given input value matches the authenticated user&#39;s current password, has been renamed to <code>current_password</code>.</p>
<p><a name="unvalidated-array-keys"></a></p>
<h4 id="unvalidated-array-keys">Unvalidated Array Keys</h4>
<p><strong>Likelihood Of Impact: Medium</strong></p>
<p>In previous releases of Laravel, you were required to manually instruct Laravel&#39;s validator to exclude unvalidated array keys from the &quot;validated&quot; data it returns, especially in combination with an <code>array</code> rule that does not specify a list of allowed keys.</p>
<p>However, in Laravel 9.x, unvalidated array keys are always excluded from the &quot;validated&quot; data even when no allowed keys have been specified via the <code>array</code> rule. Typically, this behavior is the most expected behavior and the previous <code>excludeUnvalidatedArrayKeys</code> method was only added to Laravel 8.x as a temporary measure in order to preserve backwards compatibility.</p>
<p>Although it is not recommended, you may opt-in to the previous Laravel 8.x behavior by invoking a new <code>includeUnvalidatedArrayKeys</code> method within the <code>boot</code> method of one of your application&#39;s service providers:</p>
<pre><code class="language-php"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Support</span>\<span class="hljs-title">Facades</span>\<span class="hljs-title">Validator</span>;

<span class="hljs-comment">/**
 * Register any application services.
 *
 * <span class="hljs-doctag">@return</span> void
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">boot</span>(<span class="hljs-params"></span>)
</span>{
    <span class="hljs-title class_">Validator</span>::<span class="hljs-title function_ invoke__">includeUnvalidatedArrayKeys</span>();
}
</code></pre>
<p><a name="miscellaneous"></a></p>
<h3 id="miscellaneous">Miscellaneous</h3>
<p>We also encourage you to view the changes in the <code>laravel/laravel</code> <a href="https://github.com/laravel/laravel">GitHub repository</a>. While many of these changes are not required, you may wish to keep these files in sync with your application. Some of these changes will be covered in this upgrade guide, but others, such as changes to configuration files or comments, will not be. You can easily view the changes with the <a href="https://github.com/laravel/laravel/compare/8.x...9.x">GitHub comparison tool</a> and choose which updates are important to you.</p>
